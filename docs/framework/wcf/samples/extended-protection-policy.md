---
title: 拡張保護ポリシー
ms.date: 03/30/2017
ms.assetid: e2616a10-317e-4c34-8023-0c015a80a82f
ms.openlocfilehash: c7c2e85872c158facb2de91a7413ac5a04491d7f
ms.sourcegitcommit: 581ab03291e91983459e56e40ea8d97b5189227e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/27/2019
ms.locfileid: "70044982"
---
# <a name="extended-protection-policy"></a><span data-ttu-id="d0dde-102">拡張保護ポリシー</span><span class="sxs-lookup"><span data-stu-id="d0dde-102">Extended Protection Policy</span></span>
<span data-ttu-id="d0dde-103">拡張保護は、man-in-the-middle (MITM) 攻撃に対するセキュリティ イニシアチブです。</span><span class="sxs-lookup"><span data-stu-id="d0dde-103">Extended Protection is a security initiative for protecting against man-in-the-middle (MITM) attacks.</span></span> <span data-ttu-id="d0dde-104">MITM 攻撃はセキュリティの脅威です。MITM は、クライアントの資格情報を取得し、その資格情報をサーバーに転送します。</span><span class="sxs-lookup"><span data-stu-id="d0dde-104">A MITM attack is a security threat in which a MITM takes a client’s credentials and forwards it to a server.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="d0dde-105">使用例</span><span class="sxs-lookup"><span data-stu-id="d0dde-105">Demonstrates</span></span>  
 <span data-ttu-id="d0dde-106">拡張保護</span><span class="sxs-lookup"><span data-stu-id="d0dde-106">Extended protection</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="d0dde-107">説明</span><span class="sxs-lookup"><span data-stu-id="d0dde-107">Discussion</span></span>  
 <span data-ttu-id="d0dde-108">アプリケーションが HTTPS で Kerberos、Digest または NTLM を使用して認証を実行する場合、最初にトランスポート レベルのセキュリティ (TLS) チャネルが構築され、その後セキュリティ チャネルを使用して認証が行われます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-108">When applications authenticate using Kerberos, Digest or NTLM using HTTPS, a Transport Level Security (TLS) channel is first established and then authentication takes place using the secure channel.</span></span> <span data-ttu-id="d0dde-109">しかし、SSL によって生成されるセッション キーと認証時に生成されるセッション キーはバインドされていません。</span><span class="sxs-lookup"><span data-stu-id="d0dde-109">However, there is no binding between the session key generated by SSL and the session key generated during authentication.</span></span> <span data-ttu-id="d0dde-110">サーバーはセキュリティ チャネルがクライアントまたは MITM のどちらで確立されたものであるか知ることができないため、トランスポート チャネルそのものはセキュリティで保護されていても、MITM がクライアントとサーバーの間に自身を構築し、クライアントからの要求の転送を開始する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="d0dde-110">Any MITM can establish itself between the client and the server and start forwarding the requests from the client, even when the transport channel itself is secure, because the server has no way of knowing whether the secure channel has been established from the client or a MITM.</span></span> <span data-ttu-id="d0dde-111">このシナリオの解決策として、外部の TLS チャネルを内部の認証チャネルにバインドする方法があります。この方法により、サーバーは、MITM が存在するかどうかを検出できます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-111">The solution in this scenario is to bind the outer TLS channel with the inner authentication channel such that the server can detect if there is a MITM.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d0dde-112">このサンプルは、IIS でホストされている場合にのみ機能します。Cassini (Visual Studio Development Server) は HTTPS をサポートしないため、Cassini 上では機能しません。</span><span class="sxs-lookup"><span data-stu-id="d0dde-112">This sample only works when hosted on IIS and cannot work on Cassini – Visual Studio Development Server because Cassini does not support HTTPS.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d0dde-113">この機能は現在 Windows 7 でのみ使用できます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-113">This feature is currently only available on Windows 7.</span></span> <span data-ttu-id="d0dde-114">次の手順は、Windows 7 でのみ実行できます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-114">The following steps are specific to Windows 7.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="d0dde-115">サンプルをセットアップ、ビルド、および実行するには</span><span class="sxs-lookup"><span data-stu-id="d0dde-115">To set up, build, and run the sample</span></span>  
  
1. <span data-ttu-id="d0dde-116">**[コントロールパネル]** 、 **[プログラムの追加と削除]** 、 **[Windows の機能]** からインターネットインフォメーションサービスをインストールします。</span><span class="sxs-lookup"><span data-stu-id="d0dde-116">Install Internet Information Services from **Control Panel**, **Add/Remove Programs**, **Windows Features**.</span></span>  
  
2. <span data-ttu-id="d0dde-117">Windows の**機能**、**インターネットインフォメーションサービス**、 **World Wide Web サービス**、**セキュリティ**、および**windows 認証**に**windows 認証**をインストールします。</span><span class="sxs-lookup"><span data-stu-id="d0dde-117">Install **Windows Authentication** in **Windows Features**, **Internet Information Services**, **World Wide Web Services**, **Security**, and **Windows Authentication**.</span></span>  
  
3. <span data-ttu-id="d0dde-118">**Windows の機能**、 **Microsoft .NET Framework 3.5.1**、 **Windows Communication Foundation HTTP アクティブ化**に**Windows Communication Foundation http アクティブ化**をインストールします。</span><span class="sxs-lookup"><span data-stu-id="d0dde-118">Install **Windows Communication Foundation HTTP Activation** in **Windows Features**, **Microsoft .NET Framework 3.5.1**, and **Windows Communication Foundation HTTP Activation**.</span></span>  
  
4. <span data-ttu-id="d0dde-119">このサンプルを実行するには、サーバーとの安全なチャネルを確立する必要のあるクライアントが必要なので、インターネット インフォメーション サービス (IIS) マネージャーからインストールすることのできるサーバー証明書が存在する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d0dde-119">This sample requires the client to establish a secure channel with the server, so it requires the presence of a server certificate which can be installed from Internet Information Services (IIS) Manager.</span></span>  
  
    1. <span data-ttu-id="d0dde-120">IIS マネージャーを開きます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-120">Open IIS Manager.</span></span> <span data-ttu-id="d0dde-121">**[サーバー証明書]** を開きます。ルートノード (コンピューター名) を選択すると、 **[機能ビュー]** タブに表示されます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-121">Open **Server certificates**, which appears in the **Feature View** tab when the root node (machine name) is selected.</span></span>  
  
    2. <span data-ttu-id="d0dde-122">このサンプルをテストする目的で、自己署名証明書を作成します。</span><span class="sxs-lookup"><span data-stu-id="d0dde-122">For the purpose of testing this sample, create a self-signed certificate.</span></span> <span data-ttu-id="d0dde-123">インターネット エクスプローラーで証明書の安全性に関するプロンプトが表示されないようにする場合は、信頼されたルート証明機関ストアに証明書をインストールします。</span><span class="sxs-lookup"><span data-stu-id="d0dde-123">If you do not want Internet Explorer to prompt you about the certificate not being secure, install the certificate in the Trusted Certificate Root authority store.</span></span>  
  
5. <span data-ttu-id="d0dde-124">既定の Web サイトの **[操作]** ウィンドウを開きます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-124">Open the **Actions** pane for the default Web site.</span></span> <span data-ttu-id="d0dde-125">[**サイト**と**バインド**の編集] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d0dde-125">Click **Edit Site**, **Bindings**.</span></span> <span data-ttu-id="d0dde-126">HTTPS が存在しない場合は、ポート番号を 443 に指定して HTTPS を追加します。</span><span class="sxs-lookup"><span data-stu-id="d0dde-126">Add HTTPS as a type if not already present, with port number 443.</span></span> <span data-ttu-id="d0dde-127">前の手順で作成した SSL 証明書を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-127">Assign the SSL certificate created in the preceding step.</span></span>  
  
6. <span data-ttu-id="d0dde-128">サービスをビルドします。</span><span class="sxs-lookup"><span data-stu-id="d0dde-128">Build the service.</span></span> <span data-ttu-id="d0dde-129">これにより、仮想ディレクトリが IIS に作成され、サービスを Web ホストにするために必要な .dll ファイル、.svc ファイルおよび .config ファイルがコピーされます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-129">This creates a virtual directory in IIS, and copies the .dll, .svc and .config files as required for the service to be Web hosted.</span></span>  
  
7. <span data-ttu-id="d0dde-130">IIS マネージャーを開きます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-130">Open IIS Manager.</span></span> <span data-ttu-id="d0dde-131">前の手順で作成した仮想ディレクトリ (**Extendedprotection**) を右クリックします。</span><span class="sxs-lookup"><span data-stu-id="d0dde-131">Right-click the virtual directory (**ExtendedProtection**), which was created in the preceding step.</span></span> <span data-ttu-id="d0dde-132">**[アプリケーションに変換]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="d0dde-132">Select **Convert to Application**.</span></span>  
  
8. <span data-ttu-id="d0dde-133">この仮想ディレクトリの**認証**モジュールを IIS マネージャーで開き、 **Windows 認証**を有効にします。</span><span class="sxs-lookup"><span data-stu-id="d0dde-133">Open the **Authentication** module in IIS Manager for this virtual directory and enable **Windows Authentication**.</span></span>  
  
9. <span data-ttu-id="d0dde-134">この仮想ディレクトリの **[Windows 認証]** の **[詳細設定]** を開き、 **[必須]** に設定します。</span><span class="sxs-lookup"><span data-stu-id="d0dde-134">Open **Advanced Settings** under **Windows Authentication** for this virtual directory and set it to **Required**.</span></span>  
  
10. <span data-ttu-id="d0dde-135">ブラウザー ウィンドウから HTTPS URL にアクセスして (完全修飾ドメイン名を指定します) サービスをテストできます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-135">You can test the service by accessing the HTTPS URL from a browser window (Provide a fully-qualified domain name).</span></span> <span data-ttu-id="d0dde-136">リモート コンピューターからこの URL にアクセスする場合は、すべての受信 HTTP および HTTPS 通信に対してファイアウォールが開かれていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="d0dde-136">If you want to access this URL from a remote machine, make sure that the firewall is opened for all incoming HTTP and HTTPS connections.</span></span>  
  
11. <span data-ttu-id="d0dde-137">クライアント構成ファイルを開き、クライアントの完全修飾ドメイン名、または `<<full_machine_name>>` を置き換えるエンドポイント アドレス属性を指定します。</span><span class="sxs-lookup"><span data-stu-id="d0dde-137">Open the client configuration file and provide a fully-qualified domain name for the client or endpoint address attribute that replaces `<<full_machine_name>>`.</span></span>  
  
12. <span data-ttu-id="d0dde-138">クライアントを実行します。</span><span class="sxs-lookup"><span data-stu-id="d0dde-138">Run the client.</span></span> <span data-ttu-id="d0dde-139">クライアントはサービスと通信します。これで、安全なチャネルが確立され、拡張保護が使用されます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-139">The client communicates with the service, which establishes a secure channel and uses extended protection.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="d0dde-140">サンプルは、既にコンピューターにインストールされている場合があります。</span><span class="sxs-lookup"><span data-stu-id="d0dde-140">The samples may already be installed on your machine.</span></span> <span data-ttu-id="d0dde-141">続行する前に、次の (既定の) ディレクトリを確認してください。</span><span class="sxs-lookup"><span data-stu-id="d0dde-141">Check for the following (default) directory before continuing.</span></span>  
>   
> `<InstallDrive>:\WF_WCF_Samples`  
>   
> <span data-ttu-id="d0dde-142">このディレクトリが存在しない場合は、 [Windows Communication Foundation (wcf) および Windows Workflow Foundation (WF) のサンプルの .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780)にアクセスして、すべての[!INCLUDE[wf1](../../../../includes/wf1-md.md)] Windows Communication Foundation (wcf) とサンプルをダウンロードしてください。</span><span class="sxs-lookup"><span data-stu-id="d0dde-142">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="d0dde-143">このサンプルは、次のディレクトリに格納されます。</span><span class="sxs-lookup"><span data-stu-id="d0dde-143">This sample is located in the following directory.</span></span>  
>   
> `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Services\Security\ExtendedProtection`
