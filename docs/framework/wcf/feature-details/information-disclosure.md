---
title: 情報の漏えい
ms.date: 03/30/2017
ms.assetid: 4064c89f-afa6-444a-aa7e-807ef072131c
ms.openlocfilehash: 0bcf1aa04d7ba7477a6c3f1559a77bbda1f974af
ms.sourcegitcommit: 09b4090b78f52fd09b0e430cd4b26576f1fdf96e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/17/2020
ms.locfileid: "76211951"
---
# <a name="information-disclosure"></a><span data-ttu-id="c3fcd-102">情報の漏えい</span><span class="sxs-lookup"><span data-stu-id="c3fcd-102">Information Disclosure</span></span>

<span data-ttu-id="c3fcd-103">情報が漏えいすると、攻撃者はシステムに関する重要情報を入手できます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-103">Information disclosure enables an attacker to gain valuable information about a system.</span></span> <span data-ttu-id="c3fcd-104">そのため、どのような情報を公開しているか、また、その情報が悪意のあるユーザーによって使用される可能性があるかどうかに常に気を配る必要があります。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-104">Therefore, always consider what information you are revealing and whether it can be used by a malicious user.</span></span> <span data-ttu-id="c3fcd-105">考えられる情報漏えい攻撃とその軽減策を以下に示します。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-105">The following lists possible information disclosure attacks and provides mitigations for each.</span></span>

## <a name="message-security-and-http"></a><span data-ttu-id="c3fcd-106">メッセージ セキュリティと HTTP</span><span class="sxs-lookup"><span data-stu-id="c3fcd-106">Message Security and HTTP</span></span>

<span data-ttu-id="c3fcd-107">HTTP トランスポート層でメッセージ レベルのセキュリティを使用している場合は、メッセージ レベルのセキュリティで HTTP ヘッダーが保護されないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-107">If you are using message-level security over an HTTP transport layer, be aware that message-level security does not protect HTTP headers.</span></span> <span data-ttu-id="c3fcd-108">HTTP ヘッダーを保護する唯一の方法は、HTTP ではなく、HTTPS トランスポートを使用することです。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-108">The only way to protect HTTP headers is to use HTTPS transport instead of HTTP.</span></span> <span data-ttu-id="c3fcd-109">HTTPS トランスポートを使用すると、HTTP ヘッダーを含むメッセージ全体が SSL (Secure Sockets Layer) プロトコルを使用して暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-109">HTTPS transport causes the entire message, including the HTTP headers, to be encrypted using the Secure Sockets Layer (SSL) protocol.</span></span>

## <a name="policy-information"></a><span data-ttu-id="c3fcd-110">ポリシー情報</span><span class="sxs-lookup"><span data-stu-id="c3fcd-110">Policy Information</span></span>

<span data-ttu-id="c3fcd-111">ポリシーをセキュリティで保護することが重要です。特に、機密事項が含まれる発行済みトークンの要件や、トークン発行者の情報がポリシーで公開されるフェデレーション シナリオでは重要です。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-111">Keeping policy secure is important, especially in federation scenarios where sensitive issued-token requirements or token-issuer information is exposed in policy.</span></span> <span data-ttu-id="c3fcd-112">このような場合は、フェデレーション サービスのポリシー エンドポイントをセキュリティで保護し、発行済みトークンに含まれるクレームの種類などサービスに関する情報が攻撃者の手に渡らないようにしたり、クライアントが悪意のあるトークン発行者にリダイレクトされたりしないようにすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-112">In these cases, the recommendation is to secure the federated service's policy endpoint to prevent attackers from obtaining information about the service, such as the type of claims to put in the issued token, or redirecting clients to malicious token issuers.</span></span> <span data-ttu-id="c3fcd-113">たとえば、攻撃者は、フェデレーション信頼チェーンが man-in-the-middle 攻撃を実行する発行者で終了するように再構成することで、ユーザー名/パスワードのペアを発見することがあります。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-113">For example, an attacker could discover user name/password pairs by reconfiguring the federated trust chain to terminate in an issuer that executed a man-in-the-middle attack.</span></span> <span data-ttu-id="c3fcd-114">また、ポリシーの取得によってバインディングを取得するフェデレーション クライアントの場合は、取得したフェデレーション信頼チェーンに含まれる発行者の信頼性を検証することもお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-114">It is also recommended that federated clients who obtain their bindings through policy retrieval verify that they trust the issuers in the obtained federated trust chain.</span></span> <span data-ttu-id="c3fcd-115">フェデレーションシナリオの詳細については、「[フェデレーション](../../../../docs/framework/wcf/feature-details/federation.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-115">For more information about federation scenarios, see [Federation](../../../../docs/framework/wcf/feature-details/federation.md).</span></span>

## <a name="memory-dumps-can-reveal-claim-information"></a><span data-ttu-id="c3fcd-116">メモリ ダンプによるクレーム情報の漏えい</span><span class="sxs-lookup"><span data-stu-id="c3fcd-116">Memory Dumps Can Reveal Claim Information</span></span>

<span data-ttu-id="c3fcd-117">アプリケーションにエラーが発生した場合、ワトソン博士などによって作成されたログ ファイルには、クレーム情報が含まれることがあります。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-117">When an application fails, log files, such as those produced by Dr. Watson, can contain the claim information.</span></span> <span data-ttu-id="c3fcd-118">この情報はサポート チームなどの他のエンティティに対してエクスポートしないでください。プライベートなデータを含むクレーム情報もエクスポートされます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-118">This information should not be exported to other entities, such as support teams; otherwise, the claim information that contains private data is also exported.</span></span> <span data-ttu-id="c3fcd-119">ログ ファイルを未知のエンティティに送信しないようにすることで、クレーム情報が漏えいするリスクを軽減できます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-119">You can mitigate this by not sending the log files to unknown entities.</span></span>

## <a name="endpoint-addresses"></a><span data-ttu-id="c3fcd-120">エンドポイント アドレス</span><span class="sxs-lookup"><span data-stu-id="c3fcd-120">Endpoint Addresses</span></span>

<span data-ttu-id="c3fcd-121">エンドポイント アドレスには、エンドポイントとの通信に必要な情報が含まれます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-121">An endpoint address contains the information needed to communicate with an endpoint.</span></span> <span data-ttu-id="c3fcd-122">SOAP セキュリティでは、クライアントとサーバーとの間で対称キーをネゴシエートするために交換されるセキュリティ ネゴシエーション メッセージに、完全なアドレスが含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-122">SOAP security must include the address in full in the security negotiation messages that are exchanged in order to negotiate a symmetric key between a client and a server.</span></span> <span data-ttu-id="c3fcd-123">セキュリティ ネゴシエーションはブートストラップ プロセスであるため、このプロセスの間、アドレス ヘッダーを暗号化することはできません。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-123">Because security negotiation is a bootstrap process, the address headers cannot be encrypted during this process.</span></span> <span data-ttu-id="c3fcd-124">したがって、アドレスには機密データを含めないようにします。そうしないと、情報漏えい攻撃につながります。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-124">Therefore, the address should not contain any confidential data; otherwise, it leads to information disclosure attacks.</span></span>

## <a name="certificates-transferred-unencrypted"></a><span data-ttu-id="c3fcd-125">暗号化されていない証明書の転送</span><span class="sxs-lookup"><span data-stu-id="c3fcd-125">Certificates Transferred Unencrypted</span></span>

<span data-ttu-id="c3fcd-126">クライアントの認証に X.509 証明書を使用する場合、証明書は SOAP ヘッダー内で暗号化されずに転送されます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-126">When you use an X.509 certificate to authenticate a client, the certificate is transferred in the clear, inside the SOAP header.</span></span> <span data-ttu-id="c3fcd-127">これは潜在的に個人を特定できる情報 (PII) の漏えいにつながるので注意が必要です。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-127">Be aware of this as a potential personally identifiable information (PII) disclosure.</span></span> <span data-ttu-id="c3fcd-128">トランスポート レベルのセキュリティでメッセージが暗号化される `TransportWithMessageCredential` モードでは、これは問題とはなりません。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-128">This is not an issue for `TransportWithMessageCredential` mode, where the entire message is encrypted with transport-level security.</span></span>

## <a name="service-references"></a><span data-ttu-id="c3fcd-129">サービス参照</span><span class="sxs-lookup"><span data-stu-id="c3fcd-129">Service References</span></span>

<span data-ttu-id="c3fcd-130">サービス参照は、別のサービスへの参照です。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-130">A service reference is a reference to another service.</span></span> <span data-ttu-id="c3fcd-131">たとえば、サービスは、操作の過程でクライアントにサービス参照を渡すことがあります。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-131">For example, a service may pass a service reference to a client in the course of an operation.</span></span> <span data-ttu-id="c3fcd-132">サービス参照は、*信頼 id 検証*機能と共に使用されます。これは、ターゲットプリンシパルの id を保証する内部コンポーネントであり、アプリケーションデータや資格情報などの情報をターゲットに開示する前に、このコンポーネントを使用します。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-132">The service reference is also used with a *trust identity verifier*, an internal component that ensures the identity of the target principal before disclosing information such as application data or credentials to the target.</span></span> <span data-ttu-id="c3fcd-133">リモートの信頼できる ID が検証できない、または正しくない場合、送信側は、送信者自身、アプリケーション、またはユーザーが侵害されるおそれのあるデータを開示しないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-133">If the remote trust identity cannot be verified or is incorrect, the sender should ensure that no data was disclosed that could compromise itself, the application, or the user.</span></span>

<span data-ttu-id="c3fcd-134">回避策は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-134">Mitigations include the following:</span></span>

- <span data-ttu-id="c3fcd-135">サービス参照は信頼できるものと仮定されています。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-135">Service references are assumed to be trustworthy.</span></span> <span data-ttu-id="c3fcd-136">サービス参照インスタンスを転送する場合は、改ざんされていないことを必ず確認するよう注意してください。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-136">Take care whenever transferring service reference instances to ensure that they have not been tampered with.</span></span>

- <span data-ttu-id="c3fcd-137">一部のアプリケーションで得られるユーザー エクスペリエンスでは、サービス参照内のデータと、リモート ホストによって信頼性が証明されているデータに基づいて、対話により信頼を確立することができます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-137">Some applications can present a user experience that allows interactive establishment of trust based on data in the service reference and trust data proven by the remote host.</span></span> <span data-ttu-id="c3fcd-138">WCF は、このような機能の機能拡張ポイントを提供しますが、ユーザーはそれらを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-138">WCF provides extensibility points for such a facility, but the user must implemented them.</span></span>

## <a name="ntlm"></a><span data-ttu-id="c3fcd-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="c3fcd-139">NTLM</span></span>

<span data-ttu-id="c3fcd-140">Windows ドメイン環境の既定では、Windows 認証は Kerberos プロトコルを使用して、ユーザーの認証と承認を行います。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-140">By default, in the Windows domain environment, Windows authentication uses the Kerberos protocol to authenticate and authorize users.</span></span> <span data-ttu-id="c3fcd-141">何かの理由で Kerberos プロトコルを使用できない場合は、その代替システムとして NTLM (NT LAN Manager) が使用されます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-141">If the Kerberos protocol cannot be used for some reason, NT LAN Manager (NTLM) is used as a fallback.</span></span> <span data-ttu-id="c3fcd-142"><xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> プロパティを `false` に設定することで、この動作を無効にできます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-142">You can disable this behavior by setting the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property to `false`.</span></span> <span data-ttu-id="c3fcd-143">NTLM を許可する場合は、次の点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-143">Issues to be aware of when allowing NTLM include:</span></span>

- <span data-ttu-id="c3fcd-144">NTLM はクライアントのユーザー名を公開します。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-144">NTLM exposes the client user name.</span></span> <span data-ttu-id="c3fcd-145">ユーザー名を非公開にしておく必要がある場合は、バインディングの `AllowNTLM` プロパティを `false` に設定します。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-145">If the user name needs to be kept confidential, then set the `AllowNTLM` property on the binding to `false`.</span></span>

- <span data-ttu-id="c3fcd-146">NTLM は、サーバー認証を提供しません。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-146">NTLM does not provide server authentication.</span></span> <span data-ttu-id="c3fcd-147">したがって、認証プロトコルとして NTLM が使用されていると、クライアントは自分が適切なサービスと通信しているかどうかを確認できません。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-147">Therefore, the client cannot ensure that it is communicating with the right service when you use NTLM as an authentication protocol.</span></span>

### <a name="specifying-client-credentials-or-invalid-identity-forces-ntlm-usage"></a><span data-ttu-id="c3fcd-148">クライアント資格情報または無効な ID の指定による強制的な NTLM の使用</span><span class="sxs-lookup"><span data-stu-id="c3fcd-148">Specifying Client Credentials or Invalid Identity Forces NTLM Usage</span></span>

<span data-ttu-id="c3fcd-149">クライアントの作成時に、ドメイン名なしでクライアント資格情報を指定するか、無効なサーバー ID を指定すると、Kerberos プロトコルではなく NTLM が使用されます (`AllowNtlm` プロパティが `true` に設定されている場合)。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-149">When creating a client, specifying client credentials without a domain name, or specifying an invalid server identity, causes NTLM to be used instead of the Kerberos protocol (if the `AllowNtlm` property is set to `true`).</span></span> <span data-ttu-id="c3fcd-150">NTLM ではサーバー認証を行わないため、情報が漏えいするおそれがあります。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-150">Because  NTLM does not do server authentication, information can potentially be disclosed.</span></span>

<span data-ttu-id="c3fcd-151">たとえば、次のビジュアルC#コードに示すように、ドメイン名を使用せずに Windows クライアント資格情報を指定することができます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-151">For example, it is possible to specify Windows client credentials without a domain name, as shown in the following Visual C# code.</span></span>

```csharp
MyChannelFactory.Credentials.Windows.ClientCredential = new System.Net.NetworkCredential("username", "password");
```

<span data-ttu-id="c3fcd-152">このコードではドメイン名が指定されておらず、そのため NTLM が使用されます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-152">The code does not specify a domain name, and therefore NTLM will be used.</span></span>

<span data-ttu-id="c3fcd-153">ドメインを指定していても、エンドポイント ID 機能を使用して無効なサービス プリンシパル名を指定した場合は、NTLM が使用されます。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-153">If the domain is specified, but an invalid service principal name is specified using the endpoint identity feature, then NTLM is used.</span></span> <span data-ttu-id="c3fcd-154">エンドポイント id を指定する方法の詳細については、「[サービス id と認証](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c3fcd-154">For more information about how endpoint identity is specified, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="c3fcd-155">関連項目</span><span class="sxs-lookup"><span data-stu-id="c3fcd-155">See also</span></span>

- [<span data-ttu-id="c3fcd-156">セキュリティの考慮事項</span><span class="sxs-lookup"><span data-stu-id="c3fcd-156">Security Considerations</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)
- [<span data-ttu-id="c3fcd-157">権限の昇格</span><span class="sxs-lookup"><span data-stu-id="c3fcd-157">Elevation of Privilege</span></span>](../../../../docs/framework/wcf/feature-details/elevation-of-privilege.md)
- [<span data-ttu-id="c3fcd-158">サービス拒否</span><span class="sxs-lookup"><span data-stu-id="c3fcd-158">Denial of Service</span></span>](../../../../docs/framework/wcf/feature-details/denial-of-service.md)
- [<span data-ttu-id="c3fcd-159">改変</span><span class="sxs-lookup"><span data-stu-id="c3fcd-159">Tampering</span></span>](../../../../docs/framework/wcf/feature-details/tampering.md)
- [<span data-ttu-id="c3fcd-160">サポートされていないシナリオ:</span><span class="sxs-lookup"><span data-stu-id="c3fcd-160">Unsupported Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)
- [<span data-ttu-id="c3fcd-161">リプレイ攻撃</span><span class="sxs-lookup"><span data-stu-id="c3fcd-161">Replay Attacks</span></span>](../../../../docs/framework/wcf/feature-details/replay-attacks.md)
