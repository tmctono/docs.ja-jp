---
title: '方法: 現在、印刷ジョブが印刷可能であるかどうかを検出する'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- print queues [WPF], timing
- printers [WPF], availability
- print jobs [WPF], timing
ms.assetid: 7e9c8ec1-abf6-4b3d-b1c6-33b35d3c4063
ms.openlocfilehash: 859dc75169e443d07361951692a428507886fa2e
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/22/2019
ms.locfileid: "69947811"
---
# <a name="how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day"></a><span data-ttu-id="b8405-102">方法: 現在、印刷ジョブが印刷可能であるかどうかを検出する</span><span class="sxs-lookup"><span data-stu-id="b8405-102">How to: Discover Whether a Print Job Can Be Printed At This Time of Day</span></span>
<span data-ttu-id="b8405-103">印刷キューは、1 日 24 時間利用できるとは限りません。</span><span class="sxs-lookup"><span data-stu-id="b8405-103">Print queues are not always available for 24 hours a day.</span></span> <span data-ttu-id="b8405-104">開始時刻と終了時刻のプロパティがあり、特定の時間帯に使用できないように設定できます。</span><span class="sxs-lookup"><span data-stu-id="b8405-104">They have start and end time properties that can be set to make them unavailable at certain times of day.</span></span> <span data-ttu-id="b8405-105">この機能を使用すると、たとえば、午後 5 時以降は特定の部署が排他的に使用するようにプリンターを予約することができます。</span><span class="sxs-lookup"><span data-stu-id="b8405-105">This feature can be used, for example, to reserve a printer for the exclusive use of a certain department after 5 P.M..</span></span> <span data-ttu-id="b8405-106">この部署では、他の部署が使用しているのとは異なるキューを使用します。</span><span class="sxs-lookup"><span data-stu-id="b8405-106">That department would have a different queue servicing the printer than other departments use.</span></span> <span data-ttu-id="b8405-107">他の部署のキューは、午後 5 時以降は使用不可になるように設定されるのに対し、優先される部署のキューは常に使用可能になるように設定できます。</span><span class="sxs-lookup"><span data-stu-id="b8405-107">The queue for the other departments would be set to be unavailable after 5 P.M., while queue for the favored department could be set to be available at all times.</span></span>  
  
 <span data-ttu-id="b8405-108">さらに、印刷ジョブ自体を、指定された期間内にのみ印刷できるように設定できます。</span><span class="sxs-lookup"><span data-stu-id="b8405-108">Moreover, print jobs themselves can be set to be printable only within a specified span of time.</span></span>  
  
 <span data-ttu-id="b8405-109">Microsoft .NET Framework の API で公開されている <xref:System.Printing.PrintQueue> クラスと <xref:System.Printing.PrintSystemJobInfo> クラスにより、特定の印刷ジョブが現在の時刻に特定のキューで印刷できるかどうかをリモートで確認する手段が提供されます。</span><span class="sxs-lookup"><span data-stu-id="b8405-109">The <xref:System.Printing.PrintQueue> and <xref:System.Printing.PrintSystemJobInfo> classes exposed in the APIs of Microsoft .NET Framework provide a means for remotely checking whether a given print job can print on a given queue at the current time.</span></span>  
  
## <a name="example"></a><span data-ttu-id="b8405-110">例</span><span class="sxs-lookup"><span data-stu-id="b8405-110">Example</span></span>  
 <span data-ttu-id="b8405-111">次の例は、印刷ジョブに関する問題を診断できるサンプルです。</span><span class="sxs-lookup"><span data-stu-id="b8405-111">The example below is a sample that can diagnose problems with a print job.</span></span>  
  
 <span data-ttu-id="b8405-112">この種の関数には、次の 2 つの主要な手順があります。</span><span class="sxs-lookup"><span data-stu-id="b8405-112">There are two major steps for this kind of function as follows.</span></span>  
  
1. <span data-ttu-id="b8405-113"><xref:System.Printing.PrintQueue> の <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> プロパティと <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> プロパティを読み取って、現在の時刻が両者の間にあるかどうかを判断します。</span><span class="sxs-lookup"><span data-stu-id="b8405-113">Read the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties of the <xref:System.Printing.PrintQueue> to determine whether the current time is between them.</span></span>  
  
2. <span data-ttu-id="b8405-114"><xref:System.Printing.PrintSystemJobInfo> の <xref:System.Printing.PrintSystemJobInfo.StartTimeOfDay%2A> プロパティと <xref:System.Printing.PrintSystemJobInfo.UntilTimeOfDay%2A> プロパティを読み取って、現在の時刻が両者の間にあるかどうかを判断します。</span><span class="sxs-lookup"><span data-stu-id="b8405-114">Read the <xref:System.Printing.PrintSystemJobInfo.StartTimeOfDay%2A> and <xref:System.Printing.PrintSystemJobInfo.UntilTimeOfDay%2A> properties of the <xref:System.Printing.PrintSystemJobInfo> to determine whether the current time is between them.</span></span>  
  
 <span data-ttu-id="b8405-115">しかし、これらのプロパティが <xref:System.DateTime> オブジェクトではないという事実から、複雑な問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="b8405-115">But complications arise from the fact that these properties are not <xref:System.DateTime> objects.</span></span> <span data-ttu-id="b8405-116">これらは、時刻を午前 0 時からの分数として表す <xref:System.Int32> オブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="b8405-116">Instead they are <xref:System.Int32> objects that express the time of day as the number of minutes since midnight.</span></span> <span data-ttu-id="b8405-117">さらに、現在のタイム ゾーンの午前 0 時ではなく、UTC (世界協定時) の午前 0 時です。</span><span class="sxs-lookup"><span data-stu-id="b8405-117">Moreover, this is not midnight in the current time zone, but midnight UTC (Coordinated Universal Time).</span></span>  
  
 <span data-ttu-id="b8405-118">最初のコード例は、静的メソッド **ReportQueueAndJobAvailability** を示しています。これは、<xref:System.Printing.PrintSystemJobInfo> に渡され、ヘルパー メソッドを呼び出して、現在の時刻にジョブが印刷できるかどうか、できない場合はいつ印刷できるかを判断します。</span><span class="sxs-lookup"><span data-stu-id="b8405-118">The first code example presents the static method **ReportQueueAndJobAvailability**, which is passed a <xref:System.Printing.PrintSystemJobInfo> and calls helper methods to determine whether the job can print at the current time and, if not, when it can print.</span></span> <span data-ttu-id="b8405-119"><xref:System.Printing.PrintQueue> はメソッドに渡されないことにご注意ください。</span><span class="sxs-lookup"><span data-stu-id="b8405-119">Notice that a <xref:System.Printing.PrintQueue> is not passed to the method.</span></span> <span data-ttu-id="b8405-120">これは、<xref:System.Printing.PrintSystemJobInfo> にはその <xref:System.Printing.PrintSystemJobInfo.HostingPrintQueue%2A> プロパティのキューへの参照が含まれているためです。</span><span class="sxs-lookup"><span data-stu-id="b8405-120">This is because the <xref:System.Printing.PrintSystemJobInfo> includes a reference to the queue in its <xref:System.Printing.PrintSystemJobInfo.HostingPrintQueue%2A> property.</span></span>  
  
 <span data-ttu-id="b8405-121">下位メソッドには、オーバーロードされた **ReportAvailabilityAtThisTime** メソッドが含まれています。このメソッドは、パラメーターとして <xref:System.Printing.PrintQueue> または <xref:System.Printing.PrintSystemJobInfo> を受け取ることができます。</span><span class="sxs-lookup"><span data-stu-id="b8405-121">The subordinate methods include the overloaded **ReportAvailabilityAtThisTime** method which can take either a <xref:System.Printing.PrintQueue> or a <xref:System.Printing.PrintSystemJobInfo> as a parameter.</span></span> <span data-ttu-id="b8405-122">**TimeConverter.ConvertToLocalHumanReadableTime** もあります。</span><span class="sxs-lookup"><span data-stu-id="b8405-122">There is also a **TimeConverter.ConvertToLocalHumanReadableTime**.</span></span> <span data-ttu-id="b8405-123">これらのメソッドについては、すべて以下で説明します。</span><span class="sxs-lookup"><span data-stu-id="b8405-123">All of these methods are discussed below.</span></span>  
  
 <span data-ttu-id="b8405-124">**ReportQueueAndJobAvailability** メソッドは、最初に、キューまたは印刷ジョブが現時点で使用できないかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="b8405-124">The **ReportQueueAndJobAvailability** method begins by checking to see if either the queue or the print job is unavailable at this time.</span></span> <span data-ttu-id="b8405-125">これらのいずれかが使用できない場合は、次にキューが使用できないかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="b8405-125">If either of them is unavailable, it then checks to see if the queue unavailable.</span></span> <span data-ttu-id="b8405-126">使用できない場合、このメソッドは、この事実と、キューが再び使用可能になる時刻を報告します。</span><span class="sxs-lookup"><span data-stu-id="b8405-126">If it is not available, then the method reports this fact and the time when the queue will become available again.</span></span> <span data-ttu-id="b8405-127">次にジョブを確認し、使用できない場合は、次に印刷できる時間帯を報告します。</span><span class="sxs-lookup"><span data-stu-id="b8405-127">It then checks the job and if it is unavailable, it reports the next time span when it when it can print.</span></span> <span data-ttu-id="b8405-128">最後に、このメソッドは、ジョブが印刷できる最も早い時刻を報告します。</span><span class="sxs-lookup"><span data-stu-id="b8405-128">Finally, the method reports the earliest time when the job can print.</span></span> <span data-ttu-id="b8405-129">これは、次の 2 つの時刻の遅い方です。</span><span class="sxs-lookup"><span data-stu-id="b8405-129">This is the later of following two times.</span></span>  
  
- <span data-ttu-id="b8405-130">印刷キューが次に使用可能になる時刻。</span><span class="sxs-lookup"><span data-stu-id="b8405-130">The time when the print queue is next available.</span></span>  
  
- <span data-ttu-id="b8405-131">印刷ジョブが次に使用可能になる時刻。</span><span class="sxs-lookup"><span data-stu-id="b8405-131">The time when the print job is next available.</span></span>  
  
 <span data-ttu-id="b8405-132">時刻を報告する場合に、<xref:System.DateTime.ToShortTimeString%2A> メソッドも呼び出されます。このメソッドは、出力に年、月、日が表示されないようにするからです。</span><span class="sxs-lookup"><span data-stu-id="b8405-132">When reporting times of day, the <xref:System.DateTime.ToShortTimeString%2A> method is also called because this method suppresses the years, months, and days from the output.</span></span> <span data-ttu-id="b8405-133">印刷キューまたは印刷ジョブの可用性を、特定の年、月、または日に制限することはできません。</span><span class="sxs-lookup"><span data-stu-id="b8405-133">You cannot restrict the availability of either a print queue or a print job to particular years, months, or days.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#reportqueueandjobavailability)]
 [!code-csharp[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#reportqueueandjobavailability)]
 [!code-vb[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#reportqueueandjobavailability)]  
  
 <span data-ttu-id="b8405-134">**ReportAvailabilityAtThisTime** メソッドの 2 つのオーバーロードは、これらに渡される型を除いて同じです。そのため、<xref:System.Printing.PrintQueue> バージョンのみを以下に示します。</span><span class="sxs-lookup"><span data-stu-id="b8405-134">The two overloads of the **ReportAvailabilityAtThisTime** method are identical except for the type passed to them, so only the <xref:System.Printing.PrintQueue> version is presented below.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="b8405-135">メソッドは型を除き同一であるため、サンプルでは、なぜジェネリック メソッド **ReportAvailabilityAtThisTime\<T>** が作成されないのかという疑問が生じます。</span><span class="sxs-lookup"><span data-stu-id="b8405-135">The fact that the methods are identical except for type raises the question of why the sample does not create a generic method **ReportAvailabilityAtThisTime\<T>**.</span></span> <span data-ttu-id="b8405-136">その理由は、これらのメソッドは、メソッドによって呼び出される **StartTimeOfDay** および **UntilTimeOfDay** のプロパティを持つクラスに制限する必要がありますが、ジェネリック メソッドは 1 つのクラスにしか制限できず、継承ツリー内の <xref:System.Printing.PrintQueue> と <xref:System.Printing.PrintSystemJobInfo> の両方に共通する唯一のクラスは、こうしたプロパティを持たない <xref:System.Printing.PrintSystemObject> だからです。</span><span class="sxs-lookup"><span data-stu-id="b8405-136">The reason is that such a method would have to be restricted to a class that has the **StartTimeOfDay** and **UntilTimeOfDay** properties that the method calls, but a generic method can only be restricted to a single class and the only class common to both <xref:System.Printing.PrintQueue> and <xref:System.Printing.PrintSystemJobInfo> in the inheritance tree is <xref:System.Printing.PrintSystemObject> which has no such properties.</span></span>  
  
 <span data-ttu-id="b8405-137">(下記のコード例に示されている) **ReportAvailabilityAtThisTime** メソッドは、まず <xref:System.Boolean> sentinel 変数を `true`に初期化します。</span><span class="sxs-lookup"><span data-stu-id="b8405-137">The **ReportAvailabilityAtThisTime** method (presented in the code example below) begins by initializing a <xref:System.Boolean> sentinel variable to `true`.</span></span> <span data-ttu-id="b8405-138">キューが使用できない場合は、`false` にリセットされます。</span><span class="sxs-lookup"><span data-stu-id="b8405-138">It will be reset to `false`, if the queue is not available.</span></span>  
  
 <span data-ttu-id="b8405-139">次にこのメソッドは、開始時刻と "until" (終了) 時刻が同じかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="b8405-139">Next, the method checks to see if the start and "until" times are identical.</span></span> <span data-ttu-id="b8405-140">同じ場合、キューは常に使用可能なので、メソッドは `true` を返します。</span><span class="sxs-lookup"><span data-stu-id="b8405-140">If they are, the queue is always available, so the method returns `true`.</span></span>  
  
 <span data-ttu-id="b8405-141">キューが常に利用できない場合、メソッドは静的 <xref:System.DateTime.UtcNow%2A> プロパティを使用して、<xref:System.DateTime> オブジェクトとして現在の時刻を取得します</span><span class="sxs-lookup"><span data-stu-id="b8405-141">If the queue is not available all the time, the method uses the static <xref:System.DateTime.UtcNow%2A> property to get the current time as a <xref:System.DateTime> object.</span></span> <span data-ttu-id="b8405-142">(<xref:System.Printing.PrintQueue.StartTimeOfDay%2A> プロパティと <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> プロパティは UTC 時刻であるため、現地時刻は必要ありません)。</span><span class="sxs-lookup"><span data-stu-id="b8405-142">(We do not need local time because the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties are themselves in UTC time.)</span></span>  
  
 <span data-ttu-id="b8405-143">ただし、これら 2 つのプロパティは <xref:System.DateTime> オブジェクトではありません。</span><span class="sxs-lookup"><span data-stu-id="b8405-143">However, these two properties are not <xref:System.DateTime> objects.</span></span> <span data-ttu-id="b8405-144">これらは UTC の午前 0 時からの分数として時刻を表す <xref:System.Int32> です。</span><span class="sxs-lookup"><span data-stu-id="b8405-144">They are <xref:System.Int32>s expressing the time as the number of minutes-after-UTC-midnight.</span></span> <span data-ttu-id="b8405-145">そのため、<xref:System.DateTime> オブジェクトを午前 0 時からの分数に変換する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b8405-145">So we do have to convert our <xref:System.DateTime> object to minutes-after-midnight.</span></span> <span data-ttu-id="b8405-146">それが完了すると、メソッドでは "now" (現在の時刻) がキューの開始時刻と "until" (終了) 時刻の間にあるかどうかが確認され、"now" がこの 2 つの時刻の間にない場合は sentinel が false に設定されて、sentinel が返されます。</span><span class="sxs-lookup"><span data-stu-id="b8405-146">When that is done, the method simply checks to see whether "now" is between the queue's start and "until" times, sets the sentinel to false if "now" is not between the two times, and returns the sentinel.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#PrintQueueStartUntil](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#printqueuestartuntil)]
 [!code-csharp[DiagnoseProblematicPrintJob#PrintQueueStartUntil](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#printqueuestartuntil)]
 [!code-vb[DiagnoseProblematicPrintJob#PrintQueueStartUntil](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#printqueuestartuntil)]  
  
 <span data-ttu-id="b8405-147">(下記のコード例に示されている) **TimeConverter.ConvertToLocalHumanReadableTime** メソッドは、Microsoft .NET Framework で導入されたメソッドを使用しないため、説明は簡単です。</span><span class="sxs-lookup"><span data-stu-id="b8405-147">The **TimeConverter.ConvertToLocalHumanReadableTime** method (presented in the code example below) does not use any methods introduced with Microsoft .NET Framework, so the discussion is brief.</span></span> <span data-ttu-id="b8405-148">このメソッドには、2 回の変換タスクがあります。これは、午前 0 時からの分数を表す整数値を取得し、それを人間が判読できる時刻に変換し、それを現地時刻に変換する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b8405-148">The method has a double conversion task: it must take an integer expressing minutes-after-midnight and convert it to a human-readable time and it must convert this to the local time.</span></span> <span data-ttu-id="b8405-149">これを実現するには、最初に UTC の午前 0 時に設定された <xref:System.DateTime> オブジェクトを作成し、次に <xref:System.DateTime.AddMinutes%2A> メソッドを使用して、メソッドに渡された分数を加算します。</span><span class="sxs-lookup"><span data-stu-id="b8405-149">It accomplishes this by first creating a <xref:System.DateTime> object that is set to midnight UTC and then it uses the <xref:System.DateTime.AddMinutes%2A> method to add the minutes that were passed to the method.</span></span> <span data-ttu-id="b8405-150">これにより、メソッドに渡された元の時刻を表す新しい <xref:System.DateTime> が返されます。</span><span class="sxs-lookup"><span data-stu-id="b8405-150">This returns a new <xref:System.DateTime> expressing the original time that was passed to the method.</span></span> <span data-ttu-id="b8405-151">その後、<xref:System.DateTime.ToLocalTime%2A> メソッドがこれを現地時刻に変換します。</span><span class="sxs-lookup"><span data-stu-id="b8405-151">The <xref:System.DateTime.ToLocalTime%2A> method then converts this to local time.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#TimeConverter](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#timeconverter)]
 [!code-csharp[DiagnoseProblematicPrintJob#TimeConverter](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#timeconverter)]
 [!code-vb[DiagnoseProblematicPrintJob#TimeConverter](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#timeconverter)]  
  
## <a name="see-also"></a><span data-ttu-id="b8405-152">関連項目</span><span class="sxs-lookup"><span data-stu-id="b8405-152">See also</span></span>

- <xref:System.DateTime>
- <xref:System.Printing.PrintSystemJobInfo>
- <xref:System.Printing.PrintQueue>
- [<span data-ttu-id="b8405-153">WPF のドキュメント</span><span class="sxs-lookup"><span data-stu-id="b8405-153">Documents in WPF</span></span>](documents-in-wpf.md)
- [<span data-ttu-id="b8405-154">印刷の概要</span><span class="sxs-lookup"><span data-stu-id="b8405-154">Printing Overview</span></span>](printing-overview.md)
