---
title: SQL と CLR のカスタム型マッピング
ms.date: 03/30/2017
ms.assetid: d916c7fb-4b56-4214-acbe-5e23365047b2
ms.openlocfilehash: 8901998533ec14e733ea072dd1a69b465e596328
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/07/2019
ms.locfileid: "70781089"
---
# <a name="sql-clr-custom-type-mappings"></a><span data-ttu-id="349c1-102">SQL と CLR のカスタム型マッピング</span><span class="sxs-lookup"><span data-stu-id="349c1-102">SQL-CLR Custom Type Mappings</span></span>
<span data-ttu-id="349c1-103">SQL Server と共通言語ランタイム (CLR) 間の型マッピングは、SQLMetal コマンド ライン ツールのオブジェクト リレーショナル デザイナー (O/R デザイナー) を使用すると、自動的に指定されます。</span><span class="sxs-lookup"><span data-stu-id="349c1-103">Type mapping between SQL Server and the common language runtime (CLR) is automatically specified when you use the SQLMetal command-line tool, Object Relational Designer (O/R Designer).</span></span>  
  
 <span data-ttu-id="349c1-104">カスタマイズしたマッピングが実行されない場合、これらのツールでは、「 [SQL CLR 型マッピング](sql-clr-type-mapping.md)」で説明されているように、既定の型マッピングが割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="349c1-104">When no customized mapping is performed, these tools assign default type mappings as described in [SQL-CLR Type Mapping](sql-clr-type-mapping.md).</span></span> <span data-ttu-id="349c1-105">これらの既定とは異なる型マッピングを使用する場合は、型マッピングをカスタマイズする必要があります。</span><span class="sxs-lookup"><span data-stu-id="349c1-105">If you want to type mappings differently from these defaults, you need to do some customization of the type mappings.</span></span>  
  
 <span data-ttu-id="349c1-106">型マッピングをカスタマイズする場合は、中間の DBML ファイルに変更を加える方法が推奨されます。</span><span class="sxs-lookup"><span data-stu-id="349c1-106">When customizing type mappings, the recommended approach is to make the changes in an intermediary DBML file.</span></span> <span data-ttu-id="349c1-107">次に、SQLMetal または O/R デザイナーでカスタマイズした DBML ファイルを使用して、コード ファイルとマッピング ファイルを作成します。</span><span class="sxs-lookup"><span data-stu-id="349c1-107">Then, your customized DBML file should be used when you create you code and mapping files with SQLMetal or O/R Designer.</span></span>  
  
 <span data-ttu-id="349c1-108">コード ファイルとマッピング ファイルから <xref:System.Data.Linq.DataContext> オブジェクトをインスタンス化すると、指定した型マッピングに従って <xref:System.Data.Linq.DataContext.CreateDatabase%2A?displayProperty=nameWithType> メソッドがデータベースを作成します。</span><span class="sxs-lookup"><span data-stu-id="349c1-108">Once you instantiate the <xref:System.Data.Linq.DataContext> object from the code and mapping files, the <xref:System.Data.Linq.DataContext.CreateDatabase%2A?displayProperty=nameWithType> method creates a database based on the type mappings that are specified.</span></span> <span data-ttu-id="349c1-109">マッピングに CLR の `type` 属性が指定されていない場合は、既定の型マッピングが使用されます。</span><span class="sxs-lookup"><span data-stu-id="349c1-109">If there are no CLR `type` attributes specified in the mappings, the default type mappings will be used.</span></span>  
  
## <a name="customization-with-sqlmetal-or-or-designer"></a><span data-ttu-id="349c1-110">SQLMetal または O/R デザイナーを使用したカスタマイズ</span><span class="sxs-lookup"><span data-stu-id="349c1-110">Customization with SQLMetal or O/R Designer</span></span>  
 <span data-ttu-id="349c1-111">SQLMetal と O/R デザイナーを使用すると、コード ファイルの内外の型マッピング情報を含むオブジェクト ファイルを自動作成できます。</span><span class="sxs-lookup"><span data-stu-id="349c1-111">With SQLMetal and O/R Designer, you can automatically create an object model that includes the type mapping information inside or outside the code file.</span></span> <span data-ttu-id="349c1-112">これらのファイルはマッピングを再作成するたびに SQLMetal または O/R デザイナーによって上書きされるため、カスタム型マッピングを指定する場合は DBML ファイルをカスタマイズする方法をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="349c1-112">Because these files are overwritten by SQLMetal or O/R Designer, each time you recreate your mappings, the recommended approach to specifying custom type mappings is to customize a DBML file.</span></span>  
  
 <span data-ttu-id="349c1-113">SQLMetal または O/R デザイナーで型マッピングをカスタマイズするには、最初に DBML ファイルを生成します。</span><span class="sxs-lookup"><span data-stu-id="349c1-113">To customize type mappings with SQLMetal or O/R Designer, first generate a DBML file.</span></span> <span data-ttu-id="349c1-114">次に、コード ファイルやマッピング ファイルを生成する前に、DBML ファイルを変更して適切な型マッピングを指定します。</span><span class="sxs-lookup"><span data-stu-id="349c1-114">Then, before generating the code file or mapping file, modify the DBML file to identify the desired type mappings.</span></span> <span data-ttu-id="349c1-115">SQLMetal では、DBML ファイルの `Type` 属性と `DbType` 属性を手動で変更して、型マッピングをカスタマイズする必要があります。</span><span class="sxs-lookup"><span data-stu-id="349c1-115">With SQLMetal, you have to manually change the `Type` and `DbType` attributes in the DBML file to make your type mapping customizations.</span></span> <span data-ttu-id="349c1-116">O/R デザイナーでは、デザイナー内で変更を加えることができます。</span><span class="sxs-lookup"><span data-stu-id="349c1-116">With O/R Designer, you can make your changes within the Designer.</span></span> <span data-ttu-id="349c1-117">O/R デザイナーの使用方法の詳細については、「 [Visual Studio の LINQ to SQL ツール](/visualstudio/data-tools/linq-to-sql-tools-in-visual-studio2)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="349c1-117">For more information about using the O/R Designer, see [LINQ to SQL Tools in Visual Studio](/visualstudio/data-tools/linq-to-sql-tools-in-visual-studio2).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="349c1-118">一部の型マッピングでは、データベースに対する変換操作中にオーバーフローやデータ損失の例外が発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="349c1-118">Some type mappings may result in overflow or data loss exceptions while translating to or from the database.</span></span> <span data-ttu-id="349c1-119">カスタマイズを行う前に、「 [SQL CLR 型マッピング](sql-clr-type-mapping.md)」の「型マッピングの実行時動作のマトリックス」をよく確認してください。</span><span class="sxs-lookup"><span data-stu-id="349c1-119">Carefully review the Type Mapping Run-time Behavior Matrix in [SQL-CLR Type Mapping](sql-clr-type-mapping.md) before making any customizations.</span></span>  
  
 <span data-ttu-id="349c1-120">型マッピングのカスタマイズが SQLMetal または O/R デザイナーで認識されるためには、コード ファイルや外部のマッピング ファイルを生成するときに、必ずこれらのツールにカスタム DBML ファイルのパスを提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="349c1-120">In order for your type mapping customizations to be recognized by SQLMetal or O/R Designer, you need to make sure that these tools are supplied with the path to your custom DBML file when you generate your code file or external mapping file.</span></span> <span data-ttu-id="349c1-121">型マッピングのカスタマイズでは必須ではありませんが、常に型マッピング情報をコード ファイルから分離し、外部の型マッピング ファイルを追加生成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="349c1-121">Although not required for type mapping customization, it is recommended that you always separate your type mapping information from your code file and generate the additional external type mapping file.</span></span> <span data-ttu-id="349c1-122">コード ファイルの再コンパイルを要求しないことで、柔軟性を残しておくことができます。</span><span class="sxs-lookup"><span data-stu-id="349c1-122">Doing so will leave some flexibility by not requiring that the code file be recompiled.</span></span>  
  
## <a name="incorporating-database-changes"></a><span data-ttu-id="349c1-123">データベースの変更の組み込み</span><span class="sxs-lookup"><span data-stu-id="349c1-123">Incorporating Database Changes</span></span>  
 <span data-ttu-id="349c1-124">データベースを変更すると、DBML ファイルを更新して、これらの変更を反映する必要があります。</span><span class="sxs-lookup"><span data-stu-id="349c1-124">When your database changes, you will need to update your DBML file to reflect those changes.</span></span> <span data-ttu-id="349c1-125">その 1 つの方法として、新しい DBML ファイルを自動作成してから型マッピングのカスタマイズをやり直します。</span><span class="sxs-lookup"><span data-stu-id="349c1-125">One way to do this is to automatically create a new DBML file and then re-do your type mapping customizations.</span></span> <span data-ttu-id="349c1-126">もう 1 つは、新しい DBML ファイルとカスタマイズした DBML ファイルを比較し、カスタム DBML ファイルを手動で更新してデータベースの変更を反映させる方法です。</span><span class="sxs-lookup"><span data-stu-id="349c1-126">Alternatively, you could compare the differences between your new DBML file and your customized DBML file and update your custom DBML file manually to reflect the database change.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="349c1-127">関連項目</span><span class="sxs-lookup"><span data-stu-id="349c1-127">See also</span></span>

- [<span data-ttu-id="349c1-128">SQL と CLR の型マッピング</span><span class="sxs-lookup"><span data-stu-id="349c1-128">SQL-CLR Type Mapping</span></span>](sql-clr-type-mapping.md)
- [<span data-ttu-id="349c1-129">LINQ to SQL でのコード生成</span><span class="sxs-lookup"><span data-stu-id="349c1-129">Code Generation in LINQ to SQL</span></span>](code-generation-in-linq-to-sql.md)
